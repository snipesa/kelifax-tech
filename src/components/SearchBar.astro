---
export interface Props {
  placeholder?: string;
  className?: string;
}

const { placeholder = "Search resources, tools, and platforms...", className = "" } = Astro.props;
---

<div class={`relative ${className}`}>
  <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
    <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
      <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
    </svg>
  </div>
  
  <input 
    type="text" 
    placeholder={placeholder}
    class="block w-full pl-12 pr-4 py-3 border border-gray-300 rounded-xl leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900"
    id="search-input"
  />
  
  <!-- Search suggestions dropdown (hidden by default) -->
  <div id="search-suggestions" class="hidden absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-auto">
    <div class="p-2">
      <div class="text-xs text-gray-500 font-medium uppercase tracking-wide mb-2">Recent Searches</div>
      <div class="space-y-1">
        <button class="w-full text-left px-3 py-2 hover:bg-gray-50 rounded-md text-sm text-gray-700">
          React development tools
        </button>
        <button class="w-full text-left px-3 py-2 hover:bg-gray-50 rounded-md text-sm text-gray-700">
          UI design resources
        </button>
        <button class="w-full text-left px-3 py-2 hover:bg-gray-50 rounded-md text-sm text-gray-700">
          Free learning platforms
        </button>
      </div>
    </div>
    
    <div class="border-t border-gray-200 p-2">
      <div class="text-xs text-gray-500 font-medium uppercase tracking-wide mb-2">Popular Categories</div>
      <div class="flex flex-wrap gap-1">
        <span class="inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-md cursor-pointer hover:bg-blue-200">
          Development
        </span>
        <span class="inline-block bg-green-100 text-green-800 text-xs px-2 py-1 rounded-md cursor-pointer hover:bg-green-200">
          Design
        </span>
        <span class="inline-block bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded-md cursor-pointer hover:bg-purple-200">
          Learning
        </span>
        <span class="inline-block bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded-md cursor-pointer hover:bg-orange-200">
          Productivity
        </span>
      </div>
    </div>
  </div>
</div>

<script>
  // Enhanced search functionality
  const searchInput = document.getElementById('search-input');
  const searchSuggestions = document.getElementById('search-suggestions');
  
  if (searchInput && searchSuggestions) {
    let searchTimeout;
    
    searchInput.addEventListener('focus', () => {
      searchSuggestions.classList.remove('hidden');
    });
    
    searchInput.addEventListener('blur', (e) => {
      // Delay hiding to allow clicking on suggestions
      setTimeout(() => {
        searchSuggestions.classList.add('hidden');
      }, 200);
    });
    
    searchInput.addEventListener('input', (e) => {
      const query = e.target.value.toLowerCase().trim();
      
      // Clear previous timeout
      clearTimeout(searchTimeout);
      
      if (query.length > 1) {
        // Debounce search to avoid too many requests
        searchTimeout = setTimeout(() => {
          performSearch(query);
        }, 300);
        
        searchSuggestions.classList.remove('hidden');
      } else {
        searchSuggestions.classList.add('hidden');
      }
    });
    
    searchInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        const query = searchInput.value.trim();
        if (query) {
          window.location.href = `/resources?search=${encodeURIComponent(query)}`;
        }
      }
    });
    
    // Handle suggestion clicks
    const suggestionButtons = searchSuggestions.querySelectorAll('button');
    suggestionButtons.forEach(button => {
      button.addEventListener('click', (e) => {
        const query = e.target.textContent.trim();
        searchInput.value = query;
        window.location.href = `/resources?search=${encodeURIComponent(query)}`;
      });
    });
    
    // Handle category tag clicks
    const categoryTags = searchSuggestions.querySelectorAll('span[class*="cursor-pointer"]');
    categoryTags.forEach(tag => {
      tag.addEventListener('click', (e) => {
        const category = e.target.textContent.trim().toLowerCase();
        window.location.href = `/resources?category=${encodeURIComponent(category)}`;
      });
    });
  }
  
  function performSearch(query) {
    // This would typically make an API call to get search suggestions
    // For now, we'll just show the existing suggestions
    console.log('Searching for:', query);
    
    // You could implement live search results here
    // updateSearchSuggestions(query);
  }
  
  function updateSearchSuggestions(query) {
    // Future implementation for dynamic search suggestions
    // This would call your API and update the suggestions dropdown
  }
</script>
