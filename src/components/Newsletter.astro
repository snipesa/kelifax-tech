---
export interface Props {
  variant?: 'default' | 'compact';
  className?: string;
}

const { variant = 'default', className = '' } = Astro.props;
---

<div class={`newsletter-signup ${className}`}>
  {variant === 'default' ? (
    <div class="bg-blue-600 py-16">
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <h2 class="text-3xl md:text-4xl font-bold text-white mb-4">
          Stay Updated
        </h2>
        <p class="text-xl text-blue-100 mb-8 max-w-2xl mx-auto">
          Get notified when we add new resources and tools to our platform
        </p>
        
        <form class="max-w-md mx-auto flex" id="newsletter-form">
          <input 
            type="email" 
            name="email"
            placeholder="Enter your email"
            required
            class="flex-1 px-4 py-3 rounded-l-lg border-0 focus:outline-none focus:ring-2 focus:ring-blue-300"
          />
          <button 
            type="submit"
            class="bg-blue-800 hover:bg-blue-900 text-white px-6 py-3 rounded-r-lg font-medium transition-colors"
          >
            Subscribe
          </button>
        </form>
        
        <p class="text-blue-200 text-sm mt-4">
          No spam, unsubscribe anytime. We respect your privacy.
        </p>
      </div>
    </div>
  ) : (
    <div class="bg-gray-50 p-6 rounded-lg">
      <h3 class="text-lg font-semibold text-gray-900 mb-2">
        Stay in the Loop
      </h3>
      <p class="text-gray-600 text-sm mb-4">
        Get weekly updates on new resources
      </p>
      
      <form class="flex gap-2" id="newsletter-form-compact">
        <input 
          type="email" 
          name="email"
          placeholder="Your email"
          required
          class="flex-1 px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
        />
        <button 
          type="submit"
          class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors"
        >
          Subscribe
        </button>
      </form>
    </div>
  )}
</div>

<script>
  // Newsletter signup functionality
  const forms = document.querySelectorAll('#newsletter-form, #newsletter-form-compact');
  
  forms.forEach(form => {
    if (form) {
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const formData = new FormData(form);
        const email = formData.get('email');
        const submitButton = form.querySelector('button[type="submit"]');
        const originalText = submitButton.textContent;
        
        // Update button state
        submitButton.textContent = 'Subscribing...';
        submitButton.disabled = true;
        
        try {
          // Here you would typically call your newsletter API
          // For now, we'll simulate the process
          await new Promise(resolve => setTimeout(resolve, 1000));
          
          // Show success state
          submitButton.textContent = 'Subscribed!';
          submitButton.classList.remove('bg-blue-600', 'bg-blue-800', 'hover:bg-blue-700', 'hover:bg-blue-900');
          submitButton.classList.add('bg-green-600');
          
          // Reset form
          form.reset();
          
          // Show success message
          showNotification('Thanks for subscribing! Check your email for confirmation.', 'success');
          
          // Reset button after delay
          setTimeout(() => {
            submitButton.textContent = originalText;
            submitButton.disabled = false;
            submitButton.classList.remove('bg-green-600');
            submitButton.classList.add(
              form.id === 'newsletter-form' ? 'bg-blue-800' : 'bg-blue-600',
              form.id === 'newsletter-form' ? 'hover:bg-blue-900' : 'hover:bg-blue-700'
            );
          }, 3000);
          
        } catch (error) {
          console.error('Newsletter signup error:', error);
          
          // Show error state
          submitButton.textContent = 'Try Again';
          submitButton.disabled = false;
          showNotification('Something went wrong. Please try again.', 'error');
        }
      });
    }
  });
  
  function showNotification(message, type = 'info') {
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg text-white max-w-sm transition-transform transform translate-x-full`;
    
    if (type === 'success') {
      notification.classList.add('bg-green-600');
    } else if (type === 'error') {
      notification.classList.add('bg-red-600');
    } else {
      notification.classList.add('bg-blue-600');
    }
    
    notification.innerHTML = `
      <div class="flex items-center">
        <span class="flex-1">${message}</span>
        <button class="ml-4 text-white hover:text-gray-200" onclick="this.parentElement.parentElement.remove()">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
    `;
    
    document.body.appendChild(notification);
    
    // Animate in
    setTimeout(() => {
      notification.classList.remove('translate-x-full');
    }, 100);
    
    // Auto remove after 5 seconds
    setTimeout(() => {
      if (notification.parentElement) {
        notification.classList.add('translate-x-full');
        setTimeout(() => notification.remove(), 300);
      }
    }, 5000);
  }
</script>
