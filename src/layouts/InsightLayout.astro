---
// Layout for individual insight pages
import MainLayout from './MainLayout.astro';
import RelatedResources from '../components/insights/RelatedResources.astro';
import { APP_CONFIG } from '../utils/config.js';

export interface Props {
  title: string;
  description: string;
  publishDate: Date;
  updateDate?: Date;
  author: string;
  readingTime: string;
  coverImage?: string;
  tags: string[];
  relatedResources: string[];
  seoKeywords: string[];
}

const {
  title,
  description,
  publishDate,
  updateDate,
  author,
  readingTime,
  coverImage,
  tags,
  relatedResources,
  seoKeywords
} = Astro.props;

// Format date
const formatDate = (date: Date) => {
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
};

// Generate structured data for SEO
const structuredData = {
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": title,
  "description": description,
  "author": {
    "@type": "Organization",
    "name": author
  },
  "datePublished": publishDate.toISOString(),
  "dateModified": updateDate ? updateDate.toISOString() : publishDate.toISOString(),
  "image": coverImage ? `${APP_CONFIG.SITE_URL}${coverImage}` : `${APP_CONFIG.SITE_URL}/logos/kelifax-og.png`
};

// Generate current page URL for sharing
const currentUrl = `${APP_CONFIG.SITE_URL}/insights/${Astro.url.pathname.split('/').pop()}`;
---

<MainLayout 
  title={title} 
  description={description} 
  currentPage="insights"
  keywords={seoKeywords.join(', ')}
>
  <!-- Structured Data -->
  <script type="application/ld+json" set:html={JSON.stringify(structuredData)} />
  
  <!-- Open Graph Meta Tags -->
  <meta property="og:type" content="article" slot="head" />
  <meta property="og:title" content={title} slot="head" />
  <meta property="og:description" content={description} slot="head" />
  <meta property="og:image" content={coverImage ? `${APP_CONFIG.SITE_URL}${coverImage}` : `${APP_CONFIG.SITE_URL}/logos/kelifax-og.png`} slot="head" />
  <meta property="article:published_time" content={publishDate.toISOString()} slot="head" />
  <meta property="article:author" content={author} slot="head" />
  
  <!-- Twitter Card Meta Tags -->
  <meta name="twitter:card" content="summary_large_image" slot="head" />
  <meta name="twitter:title" content={title} slot="head" />
  <meta name="twitter:description" content={description} slot="head" />
  <meta name="twitter:image" content={coverImage ? `${APP_CONFIG.SITE_URL}${coverImage}` : `${APP_CONFIG.SITE_URL}/logos/kelifax-og.png`} slot="head" />

  <article class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Article Header -->
    <header class="mb-8">
      <!-- Breadcrumb -->
      <nav class="mb-6 text-sm">
        <ol class="flex items-center space-x-2 text-gray-500">
          <li>
            <a href="/" class="hover:text-blue-600 transition-colors">Home</a>
          </li>
          <li>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </li>
          <li>
            <a href="/insights" class="hover:text-blue-600 transition-colors">Insights</a>
          </li>
          <li>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </li>
          <li class="text-gray-900 font-medium">Current Article</li>
        </ol>
      </nav>
      
      <!-- Tags -->
      {tags.length > 0 && (
        <div class="flex flex-wrap gap-2 mb-6">
          {tags.map(tag => (
            <span class="bg-blue-100 text-blue-800 text-sm px-3 py-1 rounded-full font-medium">
              {tag}
            </span>
          ))}
        </div>
      )}
      
      <!-- Title -->
      <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-6 leading-tight">
        {title}
      </h1>
      
      <!-- Meta Info -->
      <div class="flex flex-wrap items-center gap-6 text-gray-600 mb-8">
        <div class="flex items-center space-x-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
          </svg>
          <span>{author}</span>
        </div>
        <div class="flex items-center space-x-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <span>{readingTime}</span>
        </div>
      </div>
      
      <!-- Cover Image -->
      {coverImage && (
        <div class="rounded-xl overflow-hidden mb-8">
          <img 
            src={coverImage} 
            alt={title}
            class="w-full h-64 md:h-80 object-cover"
          />
        </div>
      )}
    </header>

    <!-- Article Content -->
    <div class="prose prose-base max-w-none prose-compact">
      <slot />
    </div>

    <!-- Related Resources -->
    <RelatedResources resourceSlugs={relatedResources} />

    <!-- Share Buttons -->
    <div class="mt-12 pt-8 border-t border-gray-200">
      <div class="flex items-center justify-between">
        <div>
          <h4 class="text-lg font-semibold text-gray-900 mb-2">Share this insight</h4>
          <p class="text-gray-600 text-sm">Help other developers discover this content</p>
        </div>
        <div class="flex items-center space-x-4">
          <a 
            href={`https://twitter.com/intent/tweet?text=${encodeURIComponent(title)}&url=${encodeURIComponent(currentUrl)}`}
            target="_blank"
            rel="noopener noreferrer"
            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors inline-flex items-center space-x-2"
          >
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
              <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
            </svg>
            <span>Tweet</span>
          </a>
          <a 
            href={`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(currentUrl)}`}
            target="_blank"
            rel="noopener noreferrer"
            class="bg-blue-700 hover:bg-blue-800 text-white px-4 py-2 rounded-lg transition-colors inline-flex items-center space-x-2"
          >
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
              <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
            </svg>
            <span>Share</span>
          </a>
        </div>
      </div>
    </div>

    <!-- Back to Insights -->
    <div class="mt-12 text-center">
      <a 
        href="/insights" 
        class="inline-flex items-center space-x-2 text-blue-600 hover:text-blue-700 font-medium transition-colors"
      >
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
        <span>Back to All Insights</span>
      </a>
    </div>
  </article>
</MainLayout>
